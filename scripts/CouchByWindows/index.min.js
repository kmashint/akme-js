// index.js
if(typeof console==="undefined")console=document.documentMode&&document.documentMode>=8&&this.HTA?{log:function(e){var t=document.getElementById("logDiv");if(!t)return;t.appendChild(document.createTextNode(e));t.appendChild(document.createElement("br"))},info:function(e){console.log("* "+e)},warn:function(e){console.log("? "+e)},error:function(e){console.log("! "+e)},assert:function(e){if(!e)console.log("?! "+e)}}:{log:function(){},info:function(){},warn:function(){},error:function(){},assert:function(){}};if(typeof console.logEnabled==="undefined")console.logEnabled=false;if(!Object.create)Object.create=function(){function e(){}return function(t){if(arguments.length!=1){throw new Error("Object.create implementation only accepts one parameter.")}e.prototype=t;return new e}}();if(!Object.getPrototypeOf){if({}.hasOwnProperty("__proto__"))Object.getPrototypeOf=function(e){return e.__proto__};else Object.getPrototypeOf=function(e){return e.constructor.prototype}}if(!this.akme)this.akme={THIS:this,onEvent:function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,false);else if(e.attachEvent)e.attachEvent("on"+t,n.handleEvent?akme.fixHandleEvent(n).handleEvent:n)},fixHandleEvent:function(e){if(!window.addEventListener&&typeof e.handleEvent==="function"&&!e.handleEvent_Fixed){var t=e.handleEvent;e.handleEvent=function(n){t.call(e,n)};e.handleEvent_Fixed=true}return e},getBaseHref:function(){var e=document.getElementsByTagName("base");return e.length!=0?e[0]["href"]:""},parseJSON:function(e){return JSON.parse(e)},formatJSON:function(e){return JSON.stringify(e)},copy:function(e,t,n){if(t===null||typeof t==="undefined")return e;n=!!n;for(var r in t)if(n||t.hasOwnProperty(r))e[r]=t[r];return e},copyAll:function(e,t){return this.copy(e,t,true)},getProperty:function(e,t,n){if(typeof t==="string"||t instanceof String){t=t.split(".")}var r=e;var i=t.length;for(var s=0;s<i;s++){if(r!=null&&t[s]in r)r=r[t[s]];else return n}return r},setProperty:function(e,t,n){if(typeof t==="string"||t instanceof String){t=t.split(".")}var r=e;var i=t.length-1;for(var s=0;s<i;s++){if(t[s]in r)r=r[t[s]];else r=r[t[s]]={}}r[t[i]]=n;return r},extend:function(e,t){if(typeof t==="object"){var n=e;e=t;t=n}else if(!t)t=function(){};t.prototype=typeof e==="function"?Object.create(e.prototype):e;t.superstruct=t.prototype.constructor;t.prototype.constructor=t;return t},extendDestroy:function(e,t){this.extendFunction(e,"destroy",t,true)},extendFunction:function(e,t,n,r){var i=e[t];if(i){if(r)e[t]=function(){n.apply(this,arguments);i.apply(this,arguments)};else e[t]=function(){i.apply(this,arguments);n.apply(this,arguments)}}else e[t]=n}};if(!akme.xhr)akme.xhr={open:function(e,t,n){var r=new XMLHttpRequest;r.open(e,t,n!=false);r.setRequestHeader("X-Requested-With","XMLHttpRequest");return r},encodeMap:function(e){var t=[];if(!e)return"";for(var n in e)t[t.length]=encodeURIComponent(n)+"="+encodeURIComponent(e[n]);return t.join("&")},decodeUrlEncoded:function(e){var t={};if(typeof e==="undefined"||e===null)return t;var n=String(e).split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=i.length>1?decodeURIComponent(i[1]):""}return t}};if(!akme.core){akme.core={};akme.base=akme.core}(function(e,t){function r(){if(this.EVENTS)return;if(console.logEnabled)console.log(this.constructor.CLASS+" injecting "+t+" arguments.length "+arguments.length);var r={eventMap:{}};this.EVENTS=function(e){return e===n?r:undefined};this.onEvent=s;this.unEvent=o;this.doEvent=u;e.extendDestroy(this,i)}function i(){if(console.logEnabled)console.log(this.constructor.CLASS+".destroy()");var e=this.EVENTS(n);for(var t in e.eventMap)delete e.eventMap[t]}function s(t,r,i){if(!(typeof r==="function"||typeof r.handleEvent==="function")){throw new TypeError(this.constructor.CLASS+".onEvent given neither function(ev){...} nor { handleEvent:function(ev){...} }")}var s=this.EVENTS(n),o=s.eventMap[type];if(!o){o=[];s.eventMap[type]=o}var u=e.fixHandleEvent(r);o.push({handler:u,once:!!i})}function o(e,t){var r=this.EVENTS(n),i=r.eventMap[type];if(!i)return;for(var s=0;s<i.length;s++)if(i[s].handler===t){i.splice(s,1)}}function u(e){var t=this.EVENTS(n),r=t.eventMap[e.type];if(r)for(var i=0;i<r.length;i++){var s=r[i];if(typeof s.handler==="function")s.handler.call(undefined,e);else s.handler.handleEvent.call(s.handler,e);if(s.once)r.splice(i--,1)}}if(e.getProperty(e.THIS,t))return;var n={};e.extend(Object,e.copyAll(r,{CLASS:t}));e.setProperty(e.THIS,t,r)})(fw,"akme.base.EventSource");(function(e,t){function r(t){this.name=t.name;this.getStorage=function(){return t};e.base.EventSource.apply(this)}function i(e,t){var r=this.getStorage().getItem(e+n+t);this.doEvent({type:"getItem",keyType:e,key:t,value:r});return r}function s(e,t){var r=this.getStorage().getItem(e+n+t);if(r!=null)r=akme.parseJSON(r);this.doEvent({type:"getItem",keyType:e,key:t,value:r});return r}function o(e,t,r){if(r===undefined||r==="undefined"){this.removeItem(e,t)}else{this.getStorage().setItem(e+n+t,r);this.doEvent({type:"setItem",keyType:e,key:t,value:r})}}function u(e,t,r){this.getStorage().setItem(e+n+t,akme.formatJSON(r));this.doEvent({type:"setItem",keyType:e,key:t,value:r})}function a(e,t){this.getStorage().removeItem(e+n+t);this.doEvent({type:"removeItem",keyType:e,key:t})}function f(e){var t=this.getStorage();var r=e+n;var i=0;var s={};for(var o=0;o<t.size();o++){var u=t.key(o);if(u.lastIndexOf(r,r.length)===0){s[u.substring(r.length)]=t.getItem(u);i++}}this.doEvent({type:"getAll",keyType:e,count:i,result:s});return s}function l(e,t){var r=this.getStorage();var i=0;for(var s in t){var o=e+n+s;r.setItem(o,t[s]);i++}this.doEvent({type:"setAll",keyType:e,count:i,map:t})}function c(e){var t=this.getStorage();var r=e+n;var i=0;for(var s=0;s<t.size();s++){var o=t.key(s);if(o.lastIndexOf(r,r.length)===0){t.removeItem(o);s--;i++}}this.doEvent({type:"removeAll",keyType:e,count:i})}function h(){var e=this.getStorage();for(var t=0;t<e.size();t++){var n=e.key(t);e.removeItem(n)}this.doEvent({type:"clean"})}function p(){var e=this.getStorage();var t=0;var n={};for(var r=0;r<e.size();r++){var i=e.key(r);n[i]=e.getItem(i);t++}this.doEvent({type:"exportAll",count:t,result:n});return n}function d(){var e=this.getStorage();var t=e.size();e.clear();this.doEvent({type:"clear",count:t})}function v(e){var t=e.split(",");var r={};for(var i=0;i<t.length;i++){r[t[i]]=1}var s=this.getStorage();var o=0;var u={};for(var i=0;i<s.size();i++){var a=s.key(i);var f=a.substring(0,a.indexOf(n));if(r[f]==1){continue}u[a]=s.getItem(a);o++}for(a in u){s.removeItem(a)}this.doEvent({type:"dump",count:o,result:u});return u}if(e.getProperty(e.THIS,t))return;var n=":";e.setProperty(e.THIS,t,e.extend(e.copyAll(r,{CLASS:t}),{getItem:i,setItem:o,getItemJSON:s,setItemJSON:u,removeItem:a,getAll:f,dump:v,clean:h,setAll:l,removeAll:c,exportAll:p,clear:d}))})(fw,"akme.base.Storage");if(!akme.localStorage)akme.localStorage=new akme.base.Storage({name:"akme.localStorage",length:typeof localStorage!="undefined"?localStorage.length:0,key:function(e){return localStorage.key(e)},size:function(){return this.length=localStorage.length},getItem:function(e){return localStorage.getItem(e)},setItem:function(e,t){localStorage.setItem(e,t);this.length=localStorage.length},removeItem:function(e){localStorage.removeItem(e);this.length=localStorage.length},clear:function(){localStorage.clear();this.length=localStorage.length}});if(!akme.sessionStorage)akme.sessionStorage=new akme.base.Storage({name:"akme.sessionStorage",length:typeof sessionStorage!="undefined"?sessionStorage:0,key:function(e){return sessionStorage.key(e)},size:function(){return this.length=sessionStorage.length},getItem:function(e){return sessionStorage.getItem(e)},setItem:function(e,t){sessionStorage.setItem(e,t);this.length=sessionStorage.length},removeItem:function(e){sessionStorage.removeItem(e);this.length=sessionStorage.length},clear:function(){sessionStorage.clear();this.length=sessionStorage.length}});if(!akme.base.MessageBroker)akme.base.MessageBroker=akme.extend(akme.copy(function(t){this.id=t.id;this.allowOrigins=t.allowOrigins;this.defaultTimeout=t.defaultTimeout?t.defaultTimeout:45e3},{CLASS:"akme.base.MessageBroker"}),{handleEvent:function(e){var t=true;var n=location.hostname.indexOf(".")!==-1||location.hostname.indexOf(".local",location.hostname.length-6)==location.hostname.length-6;if(e.origin==location.href.substring(0,location.href.indexOf("/",8))||!n&&e.origin.substring(e.origin.indexOf("/"))==location.href.substring(location.href.indexOf("/"),location.href.indexOf("/",8)))t=false;if(t)for(var r=0;r<this.allowOrigins.length;r++){if(this.allowOrigins[r]===e.origin&&!(n&&e.origin.indexOf(".")===-1)){t=false;break}}if(t){console.log(this.id+" deny "+e.origin);return}var i=this.parseMessage(e.data);if(!i.headers.call||typeof this[i.headers.call]!=="function")return;this[i.headers.call].call(this,i.headers,i.content,e)},formatHttpHeaderName:function(e){var t=e.split("-");for(var n=0;n<t.length;n++){t[n]=t[n].charAt(0).toUpperCase()+t[n].substring(1)}return t.join("-")},formatMessage:function(e,t){var n=[];n[n.length]="call: "+e["call"];for(var r in e)if("call"!=r&&typeof e[r]!="undefined")n[n.length]=r+": "+e[r];return n.join("\r\n")+"\r\n\r\n"+(t?t:"")},parseMessage:function(e){var t="";var n={};for(var r=0,i=e.indexOf("\n");i!=-1;r=i+1,i=e.indexOf("\n",r)){if(r+1>=i){t=e.substring(i+1);break}var s=e.indexOf(": ",r);n[e.substring(r,s)]=e.substring(s+2,i).split("\r")[0]}return{headers:n,content:t}},XMLHttpRequest:function(e,t,n){var r=akme.xhr.open(e.method,e.url,true);var i=e.callback;var s=n.source;var o=n.origin;var u=e["timeout"]?e["timeout"]:this.defaultTimeout;delete e["call"];delete e["callback"];delete e["method"];delete e["url"];delete e["timeout"];if(e)for(var a in e)r.setRequestHeader(a,e[a]);var f=this;var l;r.aborted=false;if(u>0){l=setTimeout(function(){if(window.console)console.log("aborting XHR");r.aborted=true;r.abort();var e={call:"XMLHttpResponse",readyState:4,status:599,statusText:"599 Aborted"};if(i)e["callback"]=i;var t=f.formatMessage(e,"");if(window.console)console.log(f.id+" "+location.protocol+"//"+location.host+" XMLHttpRequest postMessage back "+String(n.origin||o));if(n.source)n.source.postMessage(t,n.origin);else s.postMessage(t,o);f=r=i=n=s=o=null},u)}r.onreadystatechange=function(){var e=this;if(e.readyState!==4||e.aborted)return;if(l)clearTimeout(l);var t={call:"XMLHttpResponse",readyState:e.readyState,status:e["status"]?e.status:0,statusText:e["statusText"]?e.statusText:""};if(i)t["callback"]=i;var r=e.getAllResponseHeaders();if(r){var u=r.split("\n");for(var a=0,c=0;a<u.length&&u[a]>" ";a++){c=u[a].indexOf(": ");t[f.formatHttpHeaderName(u[a].substring(0,c))]=u[a].substring(c+2).split("\r")[0]}}var h=e["responseText"]?e.responseText:"";if(/xml;|xml$/.test(t["Content-Type"])||/html;|html$/.test(t["Content-Type"])){var p=h.indexOf("<"+"!DOCTYPE ");var d=p!==-1?h.indexOf(">",p+10):-1;if(d!==-1&&(h.lastIndexOf(" SYSTEM ",d)!==-1||document.documentMode&&document.documentMode<9&&h.lastIndexOf(" PUBLIC ",d)===-1)){h=h.substring(0,p)+h.substring(h.indexOf("<",d+1))}}var v=f.formatMessage(t,h);if(window.console)console.log(f.id+" "+location.protocol+"//"+location.host+" XMLHttpRequest postMessage back "+String(n.origin||o));if(n.source)n.source.postMessage(v,n.origin);else s.postMessage(v,o);f=e=i=n=s=o=null};r.send(t||null)},StorageRequest:function(e,t,n){var r=akme.localStorage;var i=e.callback;var s=n.source;var o=n.origin;if(t){t=r[e.method](e.type,e.key,t)}else{t=r[e.method](e.type,e.key)}if(typeof t==="object"){t=akme.formatJSON(t)}var u=e;var e={call:"StorageResponse",method:u.method,type:u.type,key:u.key};if(i)e.callback=i;var a=this.formatMessage(e,t);if(window.console)console.log(this.id+" "+location.protocol+"//"+location.host+" StorageRequest postMessage back "+String(n.origin||o));if(n.source)n.source.postMessage(a,n.origin);else s.postMessage(a,o)},WindowOpenRequest:function(e,t,n){var r=e.callback;var i=e.url.substring(0,e.url.indexOf("/",8));var s=location.protocol+"//"+location.hostname;var o=true;var u=location.hostname.indexOf(".")!==-1;for(var a=0;a<this.allowOrigins.length;a++){if(this.allowOrigins[a]===i&&!(u&&i.indexOf(".")===-1)){o=false;break}}var f={};if(e.target!="_self"){var l=akme.xhr.open("POST","sessionId.jsp",false);l.send();if(l.status!=200){console.error(this.id+" "+location.protocol+"//"+location.host+" WindowOpenRequest ER "+l.status+" "+l.statusText);return}f=akme.xhr.decodeUrlEncoded(l.responseText)}var c="j_sessionId",h="j_sessionIdSso";var p=document.createElement("form");p.setAttribute("style","display:none;");p.setAttribute("name","WindowOpenRequest");p.setAttribute("method","POST");p.setAttribute("action",i+"/afsignon/public/signon.jsp");p.setAttribute("target",e.target);p.appendChild(akme.copy(document.createElement("input"),{type:"hidden",name:c,value:f[c]}));if(f[h])p.appendChild(akme.copy(document.createElement("input"),{type:"hidden",name:h,value:f[h]}));var d=e.url.indexOf("lang=",e.url.length-12);if(d!=-1){var v=e.url.substring(d+"lang=".length);p.appendChild(akme.copy(document.createElement("input"),{type:"hidden",name:"lang",value:v}));e.url=e.url.substring(0,d)+"language="+v}p.appendChild(akme.copy(document.createElement("input"),{type:"hidden",name:"j_sessionUrl",value:e.url}));var m=document.getElementsByTagName("body")[0];m.appendChild(p);console.info("WindowOpenRequest target "+e.target+" j_sessionUrl "+e.url);setTimeout(function(){p.submit();if(document.documentMode&&document.documentMode<9){var e=document.getElementById("recycleBin");if(!e){e=document.createElement("div");m.appendChild(e)}e.appendChild(p);e.innerHTML=""}else m.removeChild(p)},100);var g=e;var e={call:"WindowOpenResponse",method:g.method,type:g.type,key:g.key};if(r)e.callback=r;var y=this.formatMessage(e,t);if(window.console)console.log(this.id+" "+location.protocol+"//"+location.host+" WindowOpenRequest postMessage back "+String(n.origin||origin));if(n.source)n.source.postMessage(y,n.origin);else source.postMessage(y,origin)}})